{
    "componentChunkName": "component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js",
    "path": "/replace-by-node/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Kuzure's blog","social":[{"name":"twitter","url":"https://twitter.com/gatsbyjs"},{"name":"github","url":"https://github.com/gatsbyjs"}]}},"blogPost":{"id":"ee29797e-7e8d-55ec-9c68-e5257c8a7f4f","excerpt":"背景是这样的，我们部门的错误码规范要改成公司的规范，之前的错误码是这样的一串数字: 3647372828，现在要改成：\"XXXXX.XXXXX.XXXXX…","body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"利用node爬虫和ast完成代码替换工作\",\n  \"date\": \"2021-08-06T00:00:00.000Z\",\n  \"image\": \"./image.jpg\",\n  \"imageAlt\": \"Laptop on a desk with VS Code open.\",\n  \"tags\": [\"前端\", \"爬虫\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"\\u80CC\\u666F\\u662F\\u8FD9\\u6837\\u7684\\uFF0C\\u6211\\u4EEC\\u90E8\\u95E8\\u7684\\u9519\\u8BEF\\u7801\\u89C4\\u8303\\u8981\\u6539\\u6210\\u516C\\u53F8\\u7684\\u89C4\\u8303\\uFF0C\\u4E4B\\u524D\\u7684\\u9519\\u8BEF\\u7801\\u662F\\u8FD9\\u6837\\u7684\\u4E00\\u4E32\\u6570\\u5B57: 3647372828\\uFF0C\\u73B0\\u5728\\u8981\\u6539\\u6210\\uFF1A\\u201CXXXXX.XXXXX.XXXXX\\u201D \\u8FD9\\u79CD\\u683C\\u5F0F\\u7684\\u5B57\\u7B26\\u4E32\\u3002\\n\\u800C\\u4E14\\u6709\\u7684\\u6539\\uFF0C\\u6709\\u7684\\u4E0D\\u6539\\uFF0C\\u6709\\u4E9B\\u9519\\u8BEF\\u7801\\u5728\\u524D\\u7AEF\\u8FD8\\u6CA1\\u6709\\u7528\\u5230\\u3002\\n\\u540E\\u7AEF\\u7ED9\\u51FA\\u7684\\u6587\\u6863\\u683C\\u5F0F\\u5982\\u4E0B\\uFF1A\"), mdx(\"table\", {\n    style: {\n      \"borderCollapse\": \"collapse\",\n      \"width\": \"100%\",\n      \"border\": \"1px solid #ddd\",\n      \"textAlign\": \"left\"\n    }\n  }, mdx(\"thead\", null, mdx(\"tr\", null, mdx(\"th\", {\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"\\u9519\\u8BEF\\u7801\\u6807\\u8BC61\"), mdx(\"th\", {\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"\\u9519\\u8BEF\\u7801\\u6807\\u8BC62\"), mdx(\"th\", {\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"\\u9519\\u8BEF\\u7801\\u6807\\u8BC63\"), mdx(\"th\", {\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"\\u9519\\u8BEF\\u4FE1\\u606F\"), mdx(\"th\", {\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"\\u539F\\u9519\\u8BEF\\u7801\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", {\n    rowSpan: \"3\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\",\n      \"verticalAlign\": \"text-bottom\"\n    }\n  }, \"XXX\"), mdx(\"td\", {\n    rowSpan: \"3\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\",\n      \"verticalAlign\": \"text-bottom\"\n    }\n  }, \"XXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"XXXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"XXXXXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"344456789\")), mdx(\"tr\", null, mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"XXXXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"XXXXXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"344323223\")), mdx(\"tr\", null, mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"XXXXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"XXXXXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"392023223\")), mdx(\"tr\", null, mdx(\"td\", {\n    rowSpan: \"10\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\",\n      \"verticalAlign\": \"text-bottom\"\n    }\n  }, \"XXX\"), mdx(\"td\", {\n    rowSpan: \"10\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\",\n      \"verticalAlign\": \"text-bottom\"\n    }\n  }, \"XXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"XXXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"XXXXXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"344456733\")), mdx(\"tr\", null, mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"XXXXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"XXXXXX\"), mdx(\"td\", {\n    colSpan: \"1\",\n    style: {\n      \"padding\": \"15px\",\n      \"border\": \"1px solid #ddd\"\n    }\n  }, \"344323222\")))), mdx(\"p\", null, \"\\u524D\\u7AEF\\u9700\\u8981\\u628A\\u539F\\u9519\\u8BEF\\u7801\\uFF0C\\u6539\\u4E3A\\u9519\\u8BEF\\u7801\\u6807\\u8BC6 1\\u30012\\u30013 \\u7528 . \\u62FC\\u63A5\\u7684\\u5B57\\u7B26\\u4E32\"), mdx(\"p\", null, \"\\u800C\\u6211\\u4EEC\\u524D\\u7AEF\\u6709\\u591A\\u4E2A\\u9519\\u8BEF\\u7801\\u5BF9\\u5E94\\u7684\\u56FD\\u9645\\u5316\\u6587\\u4EF6\\uFF0C\\u8981\\u4E00\\u4E2A\\u4E00\\u4E2A\\u627E\\u786E\\u5B9E\\u5F88\\u9EBB\\u70E6\\uFF0C\\u6839\\u636E\\u4E4B\\u524D\\u7684\\u7ECF\\u9A8C\\uFF0C\\u6211\\u4EEC\\u5DF2\\u7ECF\\u77E5\\u9053\\u53EF\\u4EE5\\n\\u4F7F\\u7528 jscodeshift \\u66F4\\u6539\\u6E90\\u4EE3\\u7801\\uFF0C\\u8FD9\\u6B21\\u4E5F\\u540C\\u7406\\uFF0C\\u53EA\\u662F\\u591A\\u4E86\\u4E00\\u4E2A\\u5C06\\u7F51\\u9875\\u4E2D\\u7684\\u8868\\u683C\\u7684\\u4FE1\\u606F\\u63D0\\u53D6\\u51FA\\u6765\\u751F\\u6210\\u4E00\\u4E2A\\u539F\\u9519\\u8BEF\\u7801\\u548C\\u65B0\\u9519\\u8BEF\\u7801\\u7684\\u6620\\u5C04\\u5BF9\\u8C61\\u7684\\u8FC7\\u7A0B\\u3002\"), mdx(\"p\", null, \"\\u6211\\u4EEC\\u53EF\\u4EE5\\u4F7F\\u7528 node \\u722C\\u866B\\u5B8C\\u6210\\u8FD9\\u4E00\\u529F\\u80FD\\u3002\"), mdx(\"p\", null, \"cli \\u5DE5\\u5177\\u7684\\u57FA\\u672C\\u751F\\u6210\\u6B65\\u9AA4\\u53EF\\u4EE5\\u53C2\\u52A0\\u6211\\u7684\\u4E0A\\u4E00\\u7BC7\\u535A\\u5BA2\\uFF0C\\u8FD9\\u91CC\\u5C31\\u4E0D\\u8D58\\u8FF0\\u4E86\\uFF0C\\u76F4\\u63A5\\u8FDB\\u5165\\u6B63\\u9898\\u3002\"), mdx(\"p\", null, \"\\u6DFB\\u52A0\\u4EE5\\u4E0B\\u4F9D\\u8D56\\uFF1A\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"\\\"superagent\\\": \\\"^6.1.0\\\",\\n\\\"cheerio\\\": \\\"^1.0.0-rc.10\\\",\\n\\\"jscodeshift\\\": \\\"^0.13.0\\\"\\n\")), mdx(\"p\", null, \"superagent \\u7528\\u4E8E\\u83B7\\u53D6\\u7F51\\u9875\\u5185\\u5BB9\\uFF0Ccheerio \\u53EF\\u4EE5\\u8BA9\\u4F60\\u50CF\\u7528 jquery \\u4E00\\u6837\\u64CD\\u4F5C dom \\u5143\\u7D20\\u3002\"), mdx(\"p\", null, \"\\u9996\\u5148\\u83B7\\u53D6\\u7F51\\u9875\\u5185\\u5BB9\\uFF1A\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"superagent.get(\\\"http://xxx.com/xxx\\\").end((err, res) => {\\n  if (err) {\\n    console.log(`\\u6293\\u53D6\\u5931\\u8D25 - ${err}`)\\n  } else {\\n    getCodeMap(res.text) // res.text\\u5C31\\u662F\\u6211\\u4EEC\\u9700\\u8981\\u7684\\u7F51\\u9875html\\u6587\\u672C\\u4E86\\n  }\\n})\\n\")), mdx(\"p\", null, \"\\u904D\\u5386\\u8868\\u683C\\u884C\\u5143\\u7D20\\uFF0C\\u5F97\\u5230\\u6620\\u5C04\\u5BF9\\u8C61\\uFF1A\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const getCodeMap = source => {\\n  let codeMap = {}\\n  let $ = cheerio.load(source)\\n  let strPrefix = \\\"\\\"\\n\\n  $(\\\"tr\\\").each((i, tr) => {\\n    let strText = \\\"\\\"\\n    $(tr)\\n      .find(\\\"td\\\")\\n      .each((i, td) => {\\n        let text = $(td).text()\\n        // \\u6709rowspan\\u5C5E\\u6027\\u7684td\\u6587\\u672C\\u5148\\u4FDD\\u7559\\u5728\\u5355\\u72EC\\u7684\\u53D8\\u91CF\\u4E2D\\n        if ($(td).attr(\\\"rowspan\\\")) {\\n          if (strPrefix.length === 0 || strPrefix.split(\\\".\\\").length === 2) {\\n            strPrefix = text\\n          } else {\\n            strPrefix = strPrefix.concat(`.${text}`)\\n          }\\n        } else if (/^[a-zA-Z]+$/.test(text)) {\\n          strText = strPrefix.concat(`.${text}`)\\n        } else if (/^[0-9]{10}$/.test(text)) {\\n          codeMap[text] = strText\\n        }\\n      })\\n  })\\n\\n  spinner.succeed(chalk.green(JSON.stringify(codeMap)))\\n\\n  return codeMap\\n}\\n\")), mdx(\"p\", null, \"\\u6700\\u540E\\u6839\\u636E\\u6620\\u5C04\\u5BF9\\u8C61\\uFF0C\\u7528 jscodeshift \\u66FF\\u6362\\u5BF9\\u5E94\\u5143\\u7D20\\u5C31\\u597D\\u5566\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const j = require(\\\"jscodeshift\\\")\\nconst fs = require(\\\"fs\\\")\\n\\nconst modifyFile = (source, codeMap) => {\\n  const ast = j(source)\\n\\n  ast\\n    .find(j.Literal)\\n    .filter(item => item.name === \\\"key\\\")\\n    .forEach(item => {\\n      // \\u5982\\u679CcodeMap\\u4E2D\\u6709\\u5BF9\\u5E94\\u7684\\u6620\\u5C04\\uFF0C\\u4E14\\u4E0D\\u4E3A\\u7A7A\\u5B57\\u7B26\\u4E32\\uFF0C\\u5C31\\u5C06\\u5176\\u66FF\\u6362\\u6210\\u6620\\u5C04\\u7684value\\n      if (codeMap[item.value.value]?.length) {\\n        j(item).replaceWith(j.literal(codeMap[item.value.value]))\\n      }\\n    })\\n\\n  return ast.toSource()\\n}\\n\\nconst replace = (filePath, codeMap) => {\\n  const originData = fs.readFileSync(filePath, \\\"utf8\\\")\\n  const newData = modifyFile(originData, codeMap)\\n\\n  fs.writeFileSync(filePath, newData)\\n}\\n\\nmodule.exports = replace\\n\")), mdx(\"p\", null, \"\\u597D\\u4E86\\uFF0Cnode\\u547D\\u4EE4\\u6267\\u884C\\u4E00\\u4E0B\\u5C31\\u51C6\\u5907\\u4E0B\\u73ED\\u5427\\uD83E\\uDD23\\u3002\"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/replace-by-node/","title":"利用node爬虫和ast完成代码替换工作","tags":["前端","爬虫"],"date":"August 06, 2021","image":null,"imageAlt":"Laptop on a desk with VS Code open.","imageCaptionText":null,"imageCaptionLink":null,"socialImage":null},"previous":{"id":"5fe50cb3-6160-5259-8e0f-bde13f4ba63b","excerpt":"最近做 qiankun 框架微前端集成的时候，遇到了主应用和子应用样式名冲突导致样式异常的问题。\n对此，qiankun 虽然给出了沙箱隔离的方案，但是这个方案对于 react 框架似乎并不怎么友好，\n而一个一个地给子应用的样式添加前缀又太繁琐，\n所以就想是否可以开发一个 cli…","slug":"/classname-prefix-cli/","title":"开发一个cli工具一键给你的css样式名添加前缀","date":"July 09, 2021"},"next":null},"pageContext":{"id":"ee29797e-7e8d-55ec-9c68-e5257c8a7f4f","previousId":"5fe50cb3-6160-5259-8e0f-bde13f4ba63b","maxWidth":1380}},
    "staticQueryHashes": ["2744905544","3090755652","764694655"]}
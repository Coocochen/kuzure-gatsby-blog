<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.94875e7429681b0b581a.css" data-identity="gatsby-global-css">:root{--reach-skip-nav:1}[data-reach-skip-nav-link]{clip:rect(0 0 0 0);border:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}[data-reach-skip-nav-link]:focus{clip:auto;background:#fff;height:auto;left:10px;padding:1rem;position:fixed;top:10px;width:auto;z-index:1}.icon{fill:currentColor;color:#fff!important;height:1em;margin-right:2px;overflow:hidden;vertical-align:-.15em;width:1em}.github-icon{margin-left:4px}</style><meta name="generator" content="Gatsby 3.8.0"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">开发一个cli工具一键给你的css样式名添加前缀 | Kuzure&#x27;s blog</title><meta data-react-helmet="true" name="description" content="最近做 qiankun 框架微前端集成的时候，遇到了主应用和子应用样式名冲突导致样式异常的问题。
对此，qiankun 虽然给出了沙箱隔离的方案，但是这个方案对于 react 框架似乎并不怎么友好，
而一个一个地给子应用的样式添加前缀又太繁琐，
所以就想是否可以开发一个 cli…"/><meta data-react-helmet="true" property="og:title" content="开发一个cli工具一键给你的css样式名添加前缀"/><meta data-react-helmet="true" property="og:description" content="最近做 qiankun 框架微前端集成的时候，遇到了主应用和子应用样式名冲突导致样式异常的问题。
对此，qiankun 虽然给出了沙箱隔离的方案，但是这个方案对于 react 框架似乎并不怎么友好，
而一个一个地给子应用的样式添加前缀又太繁琐，
所以就想是否可以开发一个 cli…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:creator" content="kuzure-东山"/><meta data-react-helmet="true" name="twitter:title" content="开发一个cli工具一键给你的css样式名添加前缀"/><meta data-react-helmet="true" name="twitter:description" content="最近做 qiankun 框架微前端集成的时候，遇到了主应用和子应用样式名冲突导致样式异常的问题。
对此，qiankun 虽然给出了沙箱隔离的方案，但是这个方案对于 react 框架似乎并不怎么友好，
而一个一个地给子应用的样式添加前缀又太繁琐，
所以就想是否可以开发一个 cli…"/><meta data-react-helmet="true" name="og:image" content="https://example.com/static/fbc0f4c542c33b30690a0d41ea976973/780b8/image.jpg"/><meta data-react-helmet="true" name="og:image:alt" content="Laptop on a desk with VS Code open."/><meta data-react-helmet="true" name="twitter:image" content="https://example.com/static/fbc0f4c542c33b30690a0d41ea976973/780b8/image.jpg"/><meta data-react-helmet="true" name="twitter:image:alt" content="Laptop on a desk with VS Code open."/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><link rel="icon" href="/favicon-32x32.png?v=06ab9d9be2014a81668d971333f1c826" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=06ab9d9be2014a81668d971333f1c826"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=06ab9d9be2014a81668d971333f1c826"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=06ab9d9be2014a81668d971333f1c826"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=06ab9d9be2014a81668d971333f1c826"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=06ab9d9be2014a81668d971333f1c826"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=06ab9d9be2014a81668d971333f1c826"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=06ab9d9be2014a81668d971333f1c826"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=06ab9d9be2014a81668d971333f1c826"/><link as="script" rel="preload" href="/webpack-runtime-382d7d0af912a126f78c.js"/><link as="script" rel="preload" href="/framework-369c4d429c17921ec939.js"/><link as="script" rel="preload" href="/app-6a201aa887ba720f50c1.js"/><link as="script" rel="preload" href="/594a10c5e594bd3faaa0b3336dcd5755131ca933-0e148508297293015b99.js"/><link as="script" rel="preload" href="/799b9e28ec84f08939ab3af68c08e0b6efc8bad3-10c420a43a2c2e7a378c.js"/><link as="script" rel="preload" href="/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-1a941de418f6affd51ef.js"/><link as="fetch" rel="preload" href="/page-data/classname-prefix-cli/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2744905544.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3090755652.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/764694655.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.documentElement.classList.add('theme-ui-' + mode);
  document.body.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion="css-global h580jr">body{--theme-ui-colors-text:#282c35;--theme-ui-colors-background:#fff;--theme-ui-colors-primary:#282c35;--theme-ui-colors-secondary:#1B1F23;--theme-ui-colors-muted:hsla(0, 0%, 0%, 0.2);--theme-ui-colors-highlight:rgba(255, 229, 100, 0.2);--theme-ui-colors-heading:#282c35;--theme-ui-colors-prism-background:#011627;--theme-ui-colors-prism-comment:#809393;--theme-ui-colors-prism-string:#addb67;--theme-ui-colors-prism-var:#d6deeb;--theme-ui-colors-prism-number:#f78c6c;--theme-ui-colors-prism-constant:#82aaff;--theme-ui-colors-prism-punctuation:#c792ea;--theme-ui-colors-prism-className:#ffc98b;--theme-ui-colors-prism-tag:#ffa7c4;--theme-ui-colors-prism-boolean:#ff5874;--theme-ui-colors-prism-property:#80cbc4;--theme-ui-colors-prism-namespace:#b2ccd6;--theme-ui-colors-prism-highlight:hsla(207, 95%, 15%, 1);color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);}body.theme-ui-dark{--theme-ui-colors-text:rgba(255, 255, 255, 0.86);--theme-ui-colors-background:#232129;--theme-ui-colors-primary:#D9BAE8;--theme-ui-colors-secondary:rgba(255, 255, 255, 0.86);--theme-ui-colors-muted:hsla(0, 0%, 100%, 0.2);--theme-ui-colors-highlight:#663399;--theme-ui-colors-heading:#fff;}</style><style data-emotion="css-global 8ir1vi">*{box-sizing:border-box;}body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css ocpejr">.css-ocpejr{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;}</style><div class="css-ocpejr"><div><style data-emotion="css 6kyqh">.css-6kyqh{background-image:url("index-bg.png");padding-bottom:80px;}</style><header class="css-6kyqh"><style data-emotion="css 1a161fb">.css-1a161fb{max-width:672px;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:32px;}</style><div class="css-1a161fb"><style data-emotion="css fplwad">.css-fplwad{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:32px;}</style><div class="css-fplwad"><style data-emotion="css 84s846">.css-84s846{margin-top:50px;margin-bottom:0;font-size:24px;}</style><style data-emotion="css 12gmd3o">.css-12gmd3o{margin-top:50px;margin-bottom:0;font-size:24px;}</style><h1 class="css-12gmd3o"><style data-emotion="css f4arw">.css-f4arw{color:white;box-shadow:none;-webkit-text-decoration:underline;text-decoration:underline;}.css-f4arw:hover{color:gray;}</style><style data-emotion="css lwud2u">.css-lwud2u{color:var(--theme-ui-colors-primary);color:white;box-shadow:none;-webkit-text-decoration:underline;text-decoration:underline;}.css-lwud2u:hover{color:gray;}</style><a class="css-lwud2u" href="/">Kuzure&#x27;s blog</a></h1></div><style data-emotion="css ve7ya4">.css-ve7ya4{margin-bottom:32px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><style data-emotion="css tcsn83">.css-tcsn83{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:32px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><div class="css-tcsn83"><style data-emotion="css 1mh8f28">.css-1mh8f28{margin-right:8px;margin-bottom:16px;width:80px;min-width:48px;border-radius:99999px;}</style><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-1mh8f28"><div style="max-width:700px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;693&#x27; width=&#x27;700&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#d8d8d8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/static/5f82e6b780a071470190da4b8cb944fe/0c3c9/avatar.webp 175w,/static/5f82e6b780a071470190da4b8cb944fe/335a6/avatar.webp 350w,/static/5f82e6b780a071470190da4b8cb944fe/b0293/avatar.webp 700w" sizes="(min-width: 700px) 700px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 700px) 700px, 100vw" decoding="async" loading="lazy" data-src="/static/5f82e6b780a071470190da4b8cb944fe/d3188/avatar.jpg" data-srcset="/static/5f82e6b780a071470190da4b8cb944fe/b7a2f/avatar.jpg 175w,/static/5f82e6b780a071470190da4b8cb944fe/5caf2/avatar.jpg 350w,/static/5f82e6b780a071470190da4b8cb944fe/d3188/avatar.jpg 700w" alt="kuzure"/></picture><noscript><picture><source type="image/webp" srcSet="/static/5f82e6b780a071470190da4b8cb944fe/0c3c9/avatar.webp 175w,/static/5f82e6b780a071470190da4b8cb944fe/335a6/avatar.webp 350w,/static/5f82e6b780a071470190da4b8cb944fe/b0293/avatar.webp 700w" sizes="(min-width: 700px) 700px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 700px) 700px, 100vw" decoding="async" loading="lazy" src="/static/5f82e6b780a071470190da4b8cb944fe/d3188/avatar.jpg" srcSet="/static/5f82e6b780a071470190da4b8cb944fe/b7a2f/avatar.jpg 175w,/static/5f82e6b780a071470190da4b8cb944fe/5caf2/avatar.jpg 350w,/static/5f82e6b780a071470190da4b8cb944fe/d3188/avatar.jpg 700w" alt="kuzure"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><div class="css-0"><div><div><style data-emotion="css 1arxws0">.css-1arxws0{color:white;font-size:24px;}</style><span class="css-1arxws0">kuzure-耳东山亘</span><style data-emotion="css 1xfcqgg">.css-1xfcqgg{color:var(--theme-ui-colors-primary);}</style><a href="https://github.com/kuzurec" class="css-1xfcqgg"><svg class="icon github-icon" aria-hidden="true"><use xlink:href="#icon-github"></use></svg></a></div><style data-emotion="css 12fs3jb">.css-12fs3jb{color:gray;font-size:13px;margin-top:4px;}</style><div class="css-12fs3jb">东边有座山</div></div></div></div></div></header></div><div id="reach-skip-nav" data-reach-skip-nav-content=""></div><div><style data-emotion="css pf2ntx">.css-pf2ntx{max-width:672px;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:32px;padding-bottom:32px;position:relative;}</style><div class="css-pf2ntx"><main><article><header><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:1380px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;805.5721393034826&#x27; width=&#x27;1380&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#e8e8e8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/static/fbc0f4c542c33b30690a0d41ea976973/1993b/image.webp 151w,/static/fbc0f4c542c33b30690a0d41ea976973/4778c/image.webp 302w,/static/fbc0f4c542c33b30690a0d41ea976973/212ef/image.webp 603w" sizes="(min-width: 603px) 603px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 603px) 603px, 100vw" decoding="async" loading="lazy" data-src="/static/fbc0f4c542c33b30690a0d41ea976973/780b8/image.jpg" data-srcset="/static/fbc0f4c542c33b30690a0d41ea976973/c7b91/image.jpg 151w,/static/fbc0f4c542c33b30690a0d41ea976973/0311b/image.jpg 302w,/static/fbc0f4c542c33b30690a0d41ea976973/780b8/image.jpg 603w" alt="Laptop on a desk with VS Code open."/></picture><noscript><picture><source type="image/webp" srcSet="/static/fbc0f4c542c33b30690a0d41ea976973/1993b/image.webp 151w,/static/fbc0f4c542c33b30690a0d41ea976973/4778c/image.webp 302w,/static/fbc0f4c542c33b30690a0d41ea976973/212ef/image.webp 603w" sizes="(min-width: 603px) 603px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 603px) 603px, 100vw" decoding="async" loading="lazy" src="/static/fbc0f4c542c33b30690a0d41ea976973/780b8/image.jpg" srcSet="/static/fbc0f4c542c33b30690a0d41ea976973/c7b91/image.jpg 151w,/static/fbc0f4c542c33b30690a0d41ea976973/0311b/image.jpg 302w,/static/fbc0f4c542c33b30690a0d41ea976973/780b8/image.jpg 603w" alt="Laptop on a desk with VS Code open."/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><h1 class="css-0">开发一个cli工具一键给你的css样式名添加前缀</h1><style data-emotion="css rsra4b">.css-rsra4b{font-size:14px;margin-top:-16px;margin-bottom:16px;}</style><style data-emotion="css 1jnjfic">.css-1jnjfic{font-size:14px;margin-top:-16px;margin-bottom:16px;}.css-1jnjfic code{font-size:inherit;}</style><p class="css-1jnjfic">July 09, 2021</p><span><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg><style data-emotion="css icq0wh">.css-icq0wh{font-size:14px;-webkit-text-decoration:none;text-decoration:none;color:gray;border-radius:12px;margin-right:9px;cursor:pointer;}.css-icq0wh:hover{color:black;border-color:black;}</style><style data-emotion="css akon1l">.css-akon1l{color:var(--theme-ui-colors-primary);font-size:14px;-webkit-text-decoration:none;text-decoration:none;color:gray;border-radius:12px;margin-right:9px;cursor:pointer;}.css-akon1l:hover{color:black;border-color:black;}</style><a class="css-akon1l" href="/#前端">前端</a></span><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg><a class="css-akon1l" href="/#AST">AST</a></span></span></header><section><style data-emotion="css 1ek8oqb">.css-1ek8oqb code{font-size:inherit;}</style><p class="css-1ek8oqb">最近做 qiankun 框架微前端集成的时候，遇到了主应用和子应用样式名冲突导致样式异常的问题。
对此，qiankun 虽然给出了沙箱隔离的方案，但是这个方案对于 react 框架似乎并不怎么友好，
而一个一个地给子应用的样式添加前缀又太繁琐，
所以就想是否可以开发一个 cli 工具，一键给项目中的 className 添加前缀。</p><p class="css-1ek8oqb">有了想法，这就上车。</p><style data-emotion="css 17gfwuz">.css-17gfwuz{pointer-events:painted;}.css-17gfwuz a{visibility:hidden;}.css-17gfwuz:hover a{visibility:visible;}</style><h3 id="开发-cli-工具" class="css-17gfwuz"><style data-emotion="css yixlj4">.css-yixlj4{margin-left:-20px;padding-right:4px;color:var(--theme-ui-colors-primary);}</style><a href="#开发-cli-工具" aria-label="开发 cli 工具" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>开发 cli 工具</h3><p class="css-1ek8oqb">首先创建一个文件夹，并进入文件夹执行 npm init ，一路回车。
在生成的 package.json 中，添加执行脚本的路径配置：</p><style data-emotion="css rczgmi">.css-rczgmi{font-family:Menlo,monospace;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;margin-bottom:8px;color:white;background-color:var(--theme-ui-colors-prism-background);overflow:auto;border-radius:10px;padding:16px;}.css-rczgmi .attr-name{font-style:italic;}.css-rczgmi .comment{color:var(--theme-ui-colors-prism-comment);}.css-rczgmi .attr-name,.css-rczgmi .string,.css-rczgmi .url{color:var(--theme-ui-colors-prism-string);}.css-rczgmi .variable{color:var(--theme-ui-colors-prism-var);}.css-rczgmi .number{color:var(--theme-ui-colors-prism-number);}.css-rczgmi .builtin,.css-rczgmi .char,.css-rczgmi .constant,.css-rczgmi .function{color:var(--theme-ui-colors-prism-constant);}.css-rczgmi .punctuation,.css-rczgmi .selector,.css-rczgmi .doctype{color:var(--theme-ui-colors-prism-punctuation);}.css-rczgmi .class-name{color:var(--theme-ui-colors-prism-className);}.css-rczgmi .tag,.css-rczgmi .operator,.css-rczgmi .keyword{color:var(--theme-ui-colors-prism-tag);}.css-rczgmi .boolean{color:var(--theme-ui-colors-prism-boolean);}.css-rczgmi .property{color:var(--theme-ui-colors-prism-property);}.css-rczgmi .namespace{color:var(--theme-ui-colors-prism-namespace);}.css-rczgmi .highlight{background:hsla(0, 0%, 40%, .5);}</style><style data-emotion="css 1q7q4hh">.css-1q7q4hh{font-family:Menlo,monospace;font-size:inherit;}</style><style data-emotion="css 1wbk7c2">.css-1wbk7c2{font-family:Menlo,monospace;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;margin-bottom:8px;color:white;background-color:var(--theme-ui-colors-prism-background);overflow:auto;border-radius:10px;padding:16px;font-family:Menlo,monospace;font-size:inherit;}.css-1wbk7c2 .attr-name{font-style:italic;}.css-1wbk7c2 .comment{color:var(--theme-ui-colors-prism-comment);}.css-1wbk7c2 .attr-name,.css-1wbk7c2 .string,.css-1wbk7c2 .url{color:var(--theme-ui-colors-prism-string);}.css-1wbk7c2 .variable{color:var(--theme-ui-colors-prism-var);}.css-1wbk7c2 .number{color:var(--theme-ui-colors-prism-number);}.css-1wbk7c2 .builtin,.css-1wbk7c2 .char,.css-1wbk7c2 .constant,.css-1wbk7c2 .function{color:var(--theme-ui-colors-prism-constant);}.css-1wbk7c2 .punctuation,.css-1wbk7c2 .selector,.css-1wbk7c2 .doctype{color:var(--theme-ui-colors-prism-punctuation);}.css-1wbk7c2 .class-name{color:var(--theme-ui-colors-prism-className);}.css-1wbk7c2 .tag,.css-1wbk7c2 .operator,.css-1wbk7c2 .keyword{color:var(--theme-ui-colors-prism-tag);}.css-1wbk7c2 .boolean{color:var(--theme-ui-colors-prism-boolean);}.css-1wbk7c2 .property{color:var(--theme-ui-colors-prism-property);}.css-1wbk7c2 .namespace{color:var(--theme-ui-colors-prism-namespace);}.css-1wbk7c2 .highlight{background:hsla(0, 0%, 40%, .5);}</style><pre class="language-json prism-code language-json css-1wbk7c2"><div class="token-line"><span class="token property">&quot;bin&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;ccpc&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;./bin/ccpc/index.js&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">,</span></div></pre><p class="css-1ek8oqb">添加以下依赖:</p><pre class="language-json prism-code language-json css-1wbk7c2"><div class="token-line"><span class="token property">&quot;commander&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token property">&quot;chalk&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;^4.1.1&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token property">&quot;ora&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;^5.4.1&quot;</span></div></pre><p class="css-1ek8oqb"><style data-emotion="css 118aluo">.css-118aluo{border-radius:0.3em;color:var(--theme-ui-colors-secondary);background-color:var(--theme-ui-colors-highlight);padding-top:0.15em;padding-bottom:0.05em;padding-left:0.2em;padding-right:0.2em;}</style><code class="css-118aluo">commander</code> 用于实现 node 命令行界面的交互。
<code class="css-118aluo">chalk</code> 可以给你的终端输出添加颜色。
<code class="css-118aluo">ora</code> 添加优雅的终端转轮</p><p class="css-1ek8oqb">在 bin/ccpc/index.js 中添加以下代码</p><pre class="language-js prism-code language-javascript css-1wbk7c2"><div class="token-line"><span class="token keyword">const</span><span class="token plain"> program </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;commander&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> chalk </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;chalk&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> ora </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;ora&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> spinner </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">ora</span><span class="token punctuation">(</span><span class="token string">&#x27;Loading undead unicorns&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><style data-emotion="css 13aqjzy">.css-13aqjzy{display:inline-block;}</style><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">program</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">command</span><span class="token punctuation">(</span><span class="token string">&quot;add &lt;prefix_name&gt;&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">option</span><span class="token punctuation">(</span><span class="token string">&quot;-d, --dir &lt;dir&gt;&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Which dir to use&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;./build&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prefix_name</span><span class="token parameter punctuation">,</span><span class="token parameter"> options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    spinner</span><span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">开始添加前缀 </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">prefix_name</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      spinner</span><span class="token punctuation">.</span><span class="token method function property-access">succeed</span><span class="token punctuation">(</span><span class="token plain">chalk</span><span class="token punctuation">.</span><span class="token method function property-access">green</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">添加前缀 </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">prefix_name</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> 成功</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">program</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token plain">process</span><span class="token punctuation">.</span><span class="token property-access">argv</span><span class="token punctuation">)</span></div></pre><p class="css-1ek8oqb">具体的用法可参考其官方文档，这里就不赘述了。我们只需要了解 command 是用于描述命令，option 用于添加可选参数，
action 定义命令的回调函数，用于执行命令的相关操作。</p><h3 id="调试" class="css-17gfwuz"><a href="#调试" aria-label="调试" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调试</h3><p class="css-1ek8oqb">直接执行 node <!-- -->[path]<!-- -->/bin/ccpc/index.js</p><p class="css-1ek8oqb">或者执行 npm link 添加软链接</p><p class="css-1ek8oqb">也可发布 npm 包后执行</p><p class="css-1ek8oqb">npm install -g <!-- -->[包名]</p><p class="css-1ek8oqb">然后就可以使用 ccpc 命令了，此时执行</p><pre class="language-cmd prism-code language-cmd css-1wbk7c2"><div class="token-line"><span class="token plain">ccpc add myprefix</span></div></pre><p class="css-1ek8oqb">可以看到命令行输出:</p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:630px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:4.057971014492754%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAANklEQVQI12OwcrGzcrU3d7SzcnXQMbDQ1jfX1jdHZugZmGvpmWsbWEAEdQ0ttfXNNXVNNXRMAH9cDAc4QaqjAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="&#x27;img-snap.png&#x27;" title="&#x27;img-snap.png&#x27;" src="/static/53fcf9ea867d9d674874ccbd61fa8281/f058b/img-snap.png" srcSet="/static/53fcf9ea867d9d674874ccbd61fa8281/e4d6b/img-snap.png 345w,/static/53fcf9ea867d9d674874ccbd61fa8281/f058b/img-snap.png 630w" sizes="(max-width: 630px) 100vw, 630px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1ek8oqb">这样一个简单的 cli 就开发完成了。</p><h3 id="匹配样式名以及添加前缀" class="css-17gfwuz"><a href="#匹配样式名以及添加前缀" aria-label="匹配样式名以及添加前缀" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>匹配样式名以及添加前缀</h3><p class="css-1ek8oqb">这里选用<code class="css-118aluo">jscodeshift</code>和<code class="css-118aluo">css-tree</code>来分别替换 js 和 css 文件。</p><p class="css-1ek8oqb">Jscodeshift 能够解析 js ，将 js 内容解析成 AST(Abstract Syntax Tree) 语法树，然后提供一些便利的操作接口，方便我们对各个节点进行更改。
css-tree 则同理，用于解析 css.</p><p class="css-1ek8oqb">添加以下代码, 读取文件转换成 string 格式， 由于是直接替换打包之后的文件，因此只需转换 js 和 css 格式的文件</p><pre class="language-js prism-code language-javascript css-1wbk7c2"><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">addPrefix</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">prefixName</span><span class="token parameter punctuation">,</span><span class="token parameter"> filePath</span><span class="token parameter punctuation">,</span><span class="token parameter"> extname</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> originData </span><span class="token operator">=</span><span class="token plain"> fs</span><span class="token punctuation">.</span><span class="token method function property-access">readFileSync</span><span class="token punctuation">(</span><span class="token plain">filePath</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> newData </span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    extname </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;.js&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">?</span><span class="token plain"> </span><span class="token function">modifyJsFile</span><span class="token punctuation">(</span><span class="token plain">prefixName</span><span class="token punctuation">,</span><span class="token plain"> originData</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">:</span><span class="token plain"> </span><span class="token function">modifyCssFile</span><span class="token punctuation">(</span><span class="token plain">prefixName</span><span class="token punctuation">,</span><span class="token plain"> originData</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  fs</span><span class="token punctuation">.</span><span class="token method function property-access">writeFileSync</span><span class="token punctuation">(</span><span class="token plain">filePath</span><span class="token punctuation">,</span><span class="token plain"> newData</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1ek8oqb">添加前缀函数：</p><pre class="language-js prism-code language-javascript css-1wbk7c2"><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">addClassNamePrefixHelper</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token parameter punctuation">,</span><span class="token parameter"> prefixName</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> classList </span><span class="token operator">=</span><span class="token plain"> name</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> newClassName </span><span class="token operator">=</span><span class="token plain"> classList</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">^(\w|-)+$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">.</span><span class="token method function property-access">test</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> i</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">prefixName</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">_</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">i</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> newClassName</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1ek8oqb">具体的修改 js 文件方法核心代码：</p><pre class="language-js prism-code language-javascript css-1wbk7c2"><div class="token-line"><span class="token keyword">const</span><span class="token plain"> ast </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">j</span><span class="token punctuation">(</span><span class="token plain">source</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// source为string格式的源代码，通过fs.redadFileSync进行转换</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment"> * 匹配 className: &quot;xxx xxx&quot;</span></div><div class="token-line"><span class="token comment"> */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">ast</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token plain">j</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Property</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;className&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token plain">j</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Literal</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">item</span><span class="token operator">?.</span><span class="token plain">value</span><span class="token operator">?.</span><span class="token plain">value </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword">typeof</span><span class="token plain"> item</span><span class="token operator">?.</span><span class="token plain">value</span><span class="token operator">?.</span><span class="token plain">value </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> newClassName </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">addClassNamePrefixHelper</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        item</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        prefixName</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">      </span><span class="token function">j</span><span class="token punctuation">(</span><span class="token plain">item</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">replaceWith</span><span class="token punctuation">(</span><span class="token plain">j</span><span class="token punctuation">.</span><span class="token method function property-access">literal</span><span class="token punctuation">(</span><span class="token plain">newClassName</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre><p class="css-1ek8oqb">css 文件：</p><pre class="language-js prism-code language-javascript css-1wbk7c2"><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">modifyCssFile</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">prefixName</span><span class="token parameter punctuation">,</span><span class="token parameter"> source</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> ast </span><span class="token operator">=</span><span class="token plain"> csstree</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token plain">source</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  csstree</span><span class="token punctuation">.</span><span class="token method function property-access">walk</span><span class="token punctuation">(</span><span class="token plain">ast</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">node</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;ClassSelector&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      node</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">prefixName</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">_</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">node</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> csstree</span><span class="token punctuation">.</span><span class="token method function property-access">generate</span><span class="token punctuation">(</span><span class="token plain">ast</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1ek8oqb">主要步骤为：查找 ast 语法树，然后找到文件指定的代码片段进行修改。我们到<a href="https://astexplorer.net/" class="css-1xfcqgg">https://astexplorer.net/</a> 网站中，
将要添加前缀的代码粘贴进去，就能看到转换后的 ast 语法树。</p><p class="css-1ek8oqb">不同的项目匹配规则可能会有差异，因此这里只给出一个思路。具体可到 <a href="https://github.com/kuzurec/css-classname-prefix-cli" class="css-1xfcqgg">git代码仓库</a> 中查看。
我已经将其发布到了 npm 中，可通过npm安装使用：</p><pre class="language-cmd prism-code language-cmd css-1wbk7c2"><div class="token-line"><span class="token plain">npm install -g css-classname-prefix-cli</span></div></pre></section></article><style data-emotion="css bw3ms">.css-bw3ms{height:500px;position:absolute;top:50px;right:-150px;}@media (max-width: 1366px){.css-bw3ms{left:0;top:8px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;height:40px;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}}</style><div class="css-bw3ms"><style data-emotion="css 1wxwq6a">.css-1wxwq6a{color:gray;margin-bottom:8px;}@media (max-width: 1366px){.css-1wxwq6a{margin-right:8px;line-height:16px;display:inline-block;height:16px;}}</style><div class="css-1wxwq6a"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg>标签</div><style data-emotion="css 1hdyz7f">.css-1hdyz7f{line-height:24px;}@media (max-width: 1366px){.css-1hdyz7f{margin-right:8px;line-height:16px;display:inline-block;height:16px;}}</style><style data-emotion="css 2rotlb">.css-2rotlb{color:var(--theme-ui-colors-primary);line-height:24px;}@media (max-width: 1366px){.css-2rotlb{margin-right:8px;line-height:16px;display:inline-block;height:16px;}}</style><a class="css-2rotlb" href="/">全部(<!-- -->0<!-- -->)</a></div></main><style data-emotion="css 1i8tjli">.css-1i8tjli{margin-top:32px;padding-top:16px;}</style><footer class="css-1i8tjli"><style data-emotion="css 1mbou4u">.css-1mbou4u{border-color:var(--theme-ui-colors-muted);}</style><hr class="css-1mbou4u"/><div class="css-tcsn83"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-1mh8f28"><div style="max-width:700px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;693&#x27; width=&#x27;700&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#d8d8d8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/static/5f82e6b780a071470190da4b8cb944fe/0c3c9/avatar.webp 175w,/static/5f82e6b780a071470190da4b8cb944fe/335a6/avatar.webp 350w,/static/5f82e6b780a071470190da4b8cb944fe/b0293/avatar.webp 700w" sizes="(min-width: 700px) 700px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 700px) 700px, 100vw" decoding="async" loading="lazy" data-src="/static/5f82e6b780a071470190da4b8cb944fe/d3188/avatar.jpg" data-srcset="/static/5f82e6b780a071470190da4b8cb944fe/b7a2f/avatar.jpg 175w,/static/5f82e6b780a071470190da4b8cb944fe/5caf2/avatar.jpg 350w,/static/5f82e6b780a071470190da4b8cb944fe/d3188/avatar.jpg 700w" alt="kuzure"/></picture><noscript><picture><source type="image/webp" srcSet="/static/5f82e6b780a071470190da4b8cb944fe/0c3c9/avatar.webp 175w,/static/5f82e6b780a071470190da4b8cb944fe/335a6/avatar.webp 350w,/static/5f82e6b780a071470190da4b8cb944fe/b0293/avatar.webp 700w" sizes="(min-width: 700px) 700px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 700px) 700px, 100vw" decoding="async" loading="lazy" src="/static/5f82e6b780a071470190da4b8cb944fe/d3188/avatar.jpg" srcSet="/static/5f82e6b780a071470190da4b8cb944fe/b7a2f/avatar.jpg 175w,/static/5f82e6b780a071470190da4b8cb944fe/5caf2/avatar.jpg 350w,/static/5f82e6b780a071470190da4b8cb944fe/d3188/avatar.jpg 700w" alt="kuzure"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><div class="css-0"><div><div><span class="css-1arxws0">kuzure-耳东山亘</span><a href="https://github.com/kuzurec" class="css-1xfcqgg"><svg class="icon github-icon" aria-hidden="true"><use xlink:href="#icon-github"></use></svg></a></div><div class="css-12fs3jb">东边有座山</div></div></div></div><style data-emotion="css 11r1i3o">.css-11r1i3o{-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;list-style:none;padding:0;}</style><style data-emotion="css f95zwa">.css-f95zwa{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;list-style:none;padding:0;}</style><ul class="css-f95zwa"><li><a rel="prev" class="css-1xfcqgg" href="/are-you-lonesome-tonight/">← <!-- -->热带往事 --发生在潮湿初夏的一段关于救赎的往事</a></li><li></li></ul></footer></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>var head = document.head || document.getElementsByTagName("head")[0];var script = document.createElement("script");script.setAttribute("src", "https://cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js");script.setAttribute("type", "text/javascript");script.setAttribute("charset", "utf8");script.setAttribute("async", "");head.appendChild(script);</script><script>var head = document.head || document.getElementsByTagName("head")[0];var script = document.createElement("script");script.setAttribute("src", "https://blog-static.cnblogs.com/files/melodyjerry/cursor-effects.js");script.setAttribute("type", "text/javascript");script.setAttribute("charset", "utf8");script.setAttribute("async", "");head.appendChild(script);</script><script>var head = document.head || document.getElementsByTagName("head")[0];var script = document.createElement("script");script.setAttribute("src", "https://at.alicdn.com/t/font_2633402_q06j6vu6n4.js");script.setAttribute("type", "text/javascript");script.setAttribute("charset", "utf8");script.setAttribute("async", "");head.appendChild(script);</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/classname-prefix-cli/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-318f69286c26ef0a1952.js"],"app":["/app-6a201aa887ba720f50c1.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-650edf50d8f6d8e3896c.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-1a941de418f6affd51ef.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js-ba0c149e85c60a940443.js"],"component---src-pages-intro-js":["/component---src-pages-intro-js-e12bf8b49e89b0fa9e71.js"]};/*]]>*/</script><script src="/polyfill-318f69286c26ef0a1952.js" nomodule=""></script><script src="/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-1a941de418f6affd51ef.js" async=""></script><script src="/799b9e28ec84f08939ab3af68c08e0b6efc8bad3-10c420a43a2c2e7a378c.js" async=""></script><script src="/594a10c5e594bd3faaa0b3336dcd5755131ca933-0e148508297293015b99.js" async=""></script><script src="/app-6a201aa887ba720f50c1.js" async=""></script><script src="/framework-369c4d429c17921ec939.js" async=""></script><script src="/webpack-runtime-382d7d0af912a126f78c.js" async=""></script></body></html>